/*
 * telemHwiUart1.c
 *
 *  Created on: Feb 14, 2015
 *      Author: mrdtdev
 */

#include "telemHwiUart1.h"

Void telemHwiUart1(UArg arg0, UArg arg1)
{
	System_printf("telemHwiUart1 has started\n");
	System_flush();

	// define extern UARTs
	extern UART_Handle uart0;
	extern UART_Handle uart1;
	extern UART_Handle uart2;
	extern UART_Handle uart3;
	extern UART_Handle uart4;
	extern UART_Handle uart5;
	extern UART_Handle uart6;
	extern UART_Handle uart7;

	// Motor Data Struct
	struct motor_data_struct motor_data_struct;

	// Valid Data Flag
	bool motor_data_is_valid = false;

	while(1)
	{
		//TODO write a mux loop with timeout to decide which device
		//mux_1( 1 );
		//ms_delay( 1 );

		//Read Uarts
		motor_data_is_valid = recv_struct( uart1, &motor_data_struct, motor_controller );

		if ( motor_data_is_valid )
		{
			//Put the data in a mailbox
			Mailbox_post(fromUartsMailbox, &motor_data_struct, BIOS_WAIT_FOREVER);
		}//endif
		else
		{
			System_printf("recv_struct( uart1, &motor_data_struct, motor_controller ) error!\n");
			System_flush();
		}//endelse

	}//endwhile

}//endfnctn
