/*
 * roveCommandParser.c
 *
 *  Created on: Jan 24, 2015
 *      Author: owen
 */

#include "roveCommand.h"

///HACKS
//#include <stdint.h>
#include <stdbool.h>
//#include "inc/hw_gpio.h"
//#include "driverlib/pin_map.h"
//#include "driverlib/sysctl.c"
//#include "driverlib/sysctl.h"
#include "driverlib/gpio.h"
//#include "driverlib/gpio.c"
//#include "inc/hw_types.h"
#include "inc/hw_memmap.h"

Void roveCommand(UArg arg0, UArg arg1)
{

	//extern bool drill_telem_active;
	//extern bool gps_telem_active;
	//extern bool power_telem_active;

	//bool cmd_valid = false;

	base_station_cmd_struct            fromBaseMsg;

	System_printf("roveCommandParser has started\n");
	System_flush();
	while(1)
	{
		System_printf("roveCommandParser is waiting for a message\n");
		System_flush();

		while(1)
			{
				// Read cmd from TCP
				cmd_valid = recv_struct( uart7, &cmd_struct, tcp_cmd );

				if ( cmd_valid == true )
				{
					switch ( cmd_struct.id )
					{
						//*************
						// Drive Left
						//*************
						case 4001:
							_struct.value = cmd_struct.value;

							mux_1( 8 );
							mux_2( 7 );
							mux_3( 6 );

							send_struct(uart1, &_struct, motor_controller);
							send_struct(uart2, &_struct, motor_controller);
							send_struct(uart3, &_struct, motor_controller);
							break;

						//*************
						// Drive Right
						//*************
						case 4002:
							_struct.value = cmd_struct.value;

							mux_1( 1 );
							mux_2( 2 );
							mux_3( 3 );

							send_struct(uart1, &_struct, motor_controller);
							send_struct(uart2, &_struct, motor_controller);
							send_struct(uart3, &_struct, motor_controller);
							break;


		Mailbox_pend(fromBaseStationMailbox, &fromBaseMsg, BIOS_WAIT_FOREVER);



		System_printf("\nCommand Parser Thread has received a command!:");
		System_printf("id - %d, value - %d\n", fromBaseMsg.id, fromBaseMsg.value);
		System_flush();
		//Wait to get data from base station

		//Dump data back to base station
	}

}


