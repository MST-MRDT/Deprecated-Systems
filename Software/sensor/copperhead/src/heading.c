/*********************************************************************
*
*   MODULE NAME:
*       heading.c
*
*   DESCRIPTION:
*
*
* Copyright 2015 by Garmin Ltd. or its subsidiaries.
*********************************************************************/

/*--------------------------------------------------------------------
                           GENERAL INCLUDES
--------------------------------------------------------------------*/
#include "chip.h"
#include "i2c.h"
#include "LSM9DS1.h"
#include "UTL_pub.h"
/*--------------------------------------------------------------------
                          LITERAL CONSTANTS
--------------------------------------------------------------------*/

/*--------------------------------------------------------------------
                                TYPES
--------------------------------------------------------------------*/

/*--------------------------------------------------------------------
                           PROJECT INCLUDES
--------------------------------------------------------------------*/

/*--------------------------------------------------------------------
                           MEMORY CONSTANTS
--------------------------------------------------------------------*/

/*--------------------------------------------------------------------
                              VARIABLES
--------------------------------------------------------------------*/
lsm9ds1 ds1;

/*--------------------------------------------------------------------
                                MACROS
--------------------------------------------------------------------*/

/*--------------------------------------------------------------------
                              PROCEDURES
--------------------------------------------------------------------*/

/****************************************************************************
*
*   PROCEDURE NAME:
*		heading_init
*
*   DESCRIPTION:
*
*   NOTES:
*
****************************************************************************/
void heading_init
    (
    void
    )
{

// Initialization of LSM9DS1 Object
uint16_t status = init_lsm9ds1( &ds1,
                                G_SCALE_245DPS,
                                A_SCALE_2G,
                                M_SCALE_4GS,
                                G_ODR_119_BW_14,
                                A_ODR_50,
                                M_ODR_40,
                                M_XY_OM_M,
                                M_Z_OM_M);

// Check I2C Communication
if (status != WHO_AM_I)
    {
    // I2C Communication Unsuccessful
    UTL_assert_always(UTL_FILE_HEADING);
    }

}	/* heading_init() */

/****************************************************************************
*
*   PROCEDURE NAME:
*		get_vessel_heading
*
*   DESCRIPTION:
*
*   NOTES:
*
****************************************************************************/
uint16 get_vessel_heading
    (
    void
    )
{
float heading_value;
uint16 return_value;

heading_value = get_heading(&ds1);
heading_value *= 10000;
return_value = (uint16) heading_value;

return return_value;
}	/* get_vessel_heading() */



